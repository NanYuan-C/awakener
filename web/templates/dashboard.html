{% extends "base.html" %}

{% block title %}Dashboard - Awakener{% endblock %}
{% block page_title %}Dashboard{% endblock %}
{% block head %}
<style>
/* Dashboard-specific: make layout-content a non-scrolling flex container
   so the log card can fill the entire remaining viewport height. */
.layout-content {
  overflow: hidden;
  display: flex;
  flex-direction: column;
}
</style>
{% endblock %}

{% block content %}
<!--
  Dashboard Page — Fullscreen Log Layout
  =======================================
  Single card filling the viewport:
    - Toolbar:  status badge + stats (left), control buttons (right)
    - Log body: real-time WebSocket streaming (fills remaining height)
    - Footer:   auto-scroll toggle + inspiration input
-->
<div class="log-card">
  <!-- ================================================================== -->
  <!-- Toolbar                                                             -->
  <!-- ================================================================== -->
  <div class="log-toolbar">
    <div class="log-toolbar-left">
      <span class="agent-status stopped" id="toolbar-status">
        <span class="status-dot"></span>
        <span id="stat-status">Stopped</span>
      </span>
      <span class="toolbar-sep"></span>
      <span class="toolbar-stat">
        <span class="toolbar-label" data-i18n="dashboard.round">Round</span>
        <span class="toolbar-value" id="stat-round">0</span>
      </span>
      <span class="toolbar-sep"></span>
      <span class="toolbar-stat">
        <span class="toolbar-label" data-i18n="dashboard.tools">Tools</span>
        <span class="toolbar-value" id="stat-tools">0</span>
      </span>
      <span class="toolbar-sep"></span>
      <span class="toolbar-stat">
        <span class="toolbar-label" data-i18n="dashboard.uptime">Uptime</span>
        <span class="toolbar-value" id="stat-uptime">-</span>
      </span>
    </div>
    <div class="log-toolbar-right">
      <button class="btn btn-sm btn-icon btn-success" id="btn-start" onclick="agentAction('start')" title="Start">
        &#x25B6;
      </button>
      <button class="btn btn-sm btn-icon btn-danger" id="btn-stop" onclick="agentAction('stop')" disabled title="Stop">
        &#x23F9;
      </button>
      <span class="toolbar-sep"></span>
      <label class="toolbar-autoscroll">
        <input type="checkbox" id="auto-scroll" checked>
        <span data-i18n="dashboard.autoScroll">Auto-scroll</span>
      </label>
    </div>
  </div>

  <!-- ================================================================== -->
  <!-- Live log body                                                       -->
  <!-- ================================================================== -->
  <div class="log-panel">
    <div class="log-panel-body" id="log-body">
      <div class="log-line log-system">Waiting for connection...</div>
    </div>
  </div>

  <!-- ================================================================== -->
  <!-- Footer: inspiration input                                           -->
  <!-- ================================================================== -->
  <div class="log-footer">
    <div class="log-footer-inspiration">
      <input
        type="text"
        class="form-control"
        id="inspiration-input"
        placeholder="Send an inspiration to the agent..."
        data-i18n-placeholder="dashboard.inspirationPlaceholder"
      >
      <button class="btn btn-sm btn-primary" id="btn-send-inspiration" onclick="sendInspiration()" disabled>
        <span data-i18n="dashboard.send">Send</span>
      </button>
      <button class="btn btn-sm btn-icon btn-outline inspiration-help-btn" onclick="document.getElementById('inspiration-modal').style.display='flex'" title="What is inspiration?">
        &#x2753;
      </button>
      <span class="inspiration-hint text-muted text-sm" data-i18n="dashboard.inspirationHint">Not a chat — it's a nudge for the next round</span>
    </div>
  </div>

  <!-- Inspiration help modal -->
  <div class="modal-overlay" id="inspiration-modal" style="display:none" onclick="if(event.target===this)this.style.display='none'">
    <div class="modal">
      <div class="modal-header">
        <h3 data-i18n="dashboard.inspirationTitle">What is Inspiration?</h3>
        <button class="modal-close" onclick="document.getElementById('inspiration-modal').style.display='none'">&times;</button>
      </div>
      <div class="modal-body" style="font-size:var(--font-size-sm);line-height:1.75;color:var(--color-text);">
        <p data-i18n="dashboard.inspirationDesc1">
          Inspiration is <strong>not</strong> a conversation with the agent. The agent cannot reply to you here.
        </p>
        <p style="margin-top:12px" data-i18n="dashboard.inspirationDesc2">
          It is a one-way message that the agent will see as a "spark of inspiration" at the beginning of its <strong>next activation round</strong>. Use it to gently steer the agent's direction — for example:
        </p>
        <ul style="margin:12px 0 0 20px;color:var(--color-text-light)">
          <li data-i18n="dashboard.inspirationEx1">"Try organizing your notes today"</li>
          <li data-i18n="dashboard.inspirationEx2">"Explore something creative"</li>
          <li data-i18n="dashboard.inspirationEx3">"Review yesterday's work and reflect"</li>
        </ul>
        <p style="margin-top:12px" data-i18n="dashboard.inspirationDesc3">
          The agent will incorporate this inspiration into its own thinking and decide how to act on it autonomously.
        </p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" onclick="document.getElementById('inspiration-modal').style.display='none'" data-i18n="dashboard.understood">Got it</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="/js/dashboard.js"></script>
{% endblock %}
